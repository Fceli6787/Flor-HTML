<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Un Regalo Mágico para Ti</title>
    
    <!-- fuente Winky Rough -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Winky+Rough:wght@700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuracion Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'winky': ['"Winky Rough"', 'cursive'],
                    },
                }
            }
        }
    </script>
</head>
<body class="font-winky h-screen w-screen overflow-hidden flex items-center justify-center">
    
    <canvas id="canvas" class="absolute top-0 left-0 w-full h-full"></canvas>

    <!-- Contenedor para los mensajes secuenciales -->
    <div id="message" 
         class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 
                w-11/12 md:w-auto bg-white/80 backdrop-blur-lg shadow-2xl p-6 rounded-xl
                text-center text-3xl md:text-5xl text-slate-800
                opacity-0 transition-opacity duration-1000 ease-in-out">
    </div>

    <!-- Mensaje final -->
    <div id="finalMessage" 
         class="absolute top-[8%] left-1/2 -translate-x-1/2 
                w-11/12 md:w-auto bg-indigo-900/70 backdrop-blur-lg shadow-2xl p-6 rounded-xl
                text-center text-4xl md:text-6xl text-amber-300
                opacity-0 transition-opacity duration-1000 ease-in-out">
    </div>
    
    <!-- La firma -->
    <div id="signature"
         class="absolute bottom-5 right-6
                text-xl text-white/80
                opacity-0 transition-opacity duration-1000 ease-in-out">
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const messageEl = document.getElementById('message');
        const finalMessageEl = document.getElementById('finalMessage');
        const signatureEl = document.getElementById('signature'); // 2. Referencia a la firma

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        let progress = 0;
        let flowerComplete = false;
        let puedeCrecer = false;
        let currentMessageIndex = 0;

        const messages = [
            "¡Oye!",
            "Sí, ¡te hablo a ti!",
            "Quería enviarte esto...",
            "...porque es mi forma de darte un regalo.",
            "Siendo ingeniero de sistemas, mi creatividad no tiene límites...",
            "...para demostrar lo mucho que te quiero.",
            "Espero que disfrutes este detalle tanto como yo disfruté creándolo para ti.",
            "Y ahora, observa la magia..."
        ];

        function showNextMessage() {
            if (currentMessageIndex < messages.length) {
                messageEl.textContent = messages[currentMessageIndex];
                messageEl.classList.remove('opacity-0');

                setTimeout(() => {
                    messageEl.classList.add('opacity-0');
                    setTimeout(() => {
                        currentMessageIndex++;
                        showNextMessage();
                    }, 1000);
                }, 3500);
            } else {
                messageEl.style.display = 'none';
                puedeCrecer = true;
            }
        }

        let stars = [];
        function createStars() {
            for (let i = 0; i < 100; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height * 0.7,
                    radius: Math.random() * 1.5,
                    opacity: Math.random() * 0.5 + 0.5
                });
            }
        }

        function drawSky(p) {
            const dayColor = { r: 135, g: 206, b: 235 };
            const nightColor = { r: 25, g: 25, b: 112 };
            
            const r = dayColor.r + (nightColor.r - dayColor.r) * p;
            const g = dayColor.g + (nightColor.g - dayColor.g) * p;
            const b = dayColor.b + (nightColor.b - dayColor.b) * p;

            const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            skyGradient.addColorStop(0, `rgb(${r}, ${g}, ${b})`);
            skyGradient.addColorStop(1, 'rgba(255, 255, 255, 1)');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (p > 0.5) {
                stars.forEach(star => {
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                    const twinkle = Math.abs(Math.sin(Date.now() * 0.001 + star.x));
                    ctx.fillStyle = `rgba(255, 255, 255, ${(p - 0.5) * 2 * twinkle * star.opacity})`;
                    ctx.fill();
                });
            }
        }

        function drawGrass(p) {
            const grassProgress = puedeCrecer ? p : 0;
            ctx.fillStyle = `rgb(34, 139, 34)`;
            ctx.fillRect(0, canvas.height * 0.8, canvas.width, canvas.height * 0.2 * grassProgress);
        }
        
        function drawFlower(p, sway) {
            const centerX = canvas.width / 2 + sway;
            const centerY = canvas.height * 0.4;
            const radius = Math.min(canvas.width, canvas.height) / 9;

            const stemProgress = Math.min(1, p / 0.3);
            if (stemProgress > 0) {
                ctx.beginPath();
                ctx.moveTo(canvas.width / 2, canvas.height * 0.8);
                ctx.lineTo(canvas.width / 2, canvas.height * 0.8 - (canvas.height * 0.4 * stemProgress));
                ctx.strokeStyle = `rgb(0, 128, 0)`;
                ctx.lineWidth = canvas.width * 0.01;
                ctx.stroke();
            }

            const petalProgress = Math.max(0, (p - 0.3) / 0.6);
            if(petalProgress > 0) {
                 for (let i = 0; i < 5; i++) {
                    const angle = (i / 5) * Math.PI * 2;
                    ctx.save();
                    ctx.translate(centerX, centerY);
                    ctx.rotate(angle);
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.quadraticCurveTo(radius * 0.5, -radius * 0.7, radius * petalProgress, 0);
                    ctx.quadraticCurveTo(radius * 0.5, radius * 0.7, 0, 0);
                    ctx.fillStyle = `rgba(255, 204, 0, 1)`;
                    ctx.fill();
                    ctx.restore();
                }
            }

            const centerProgress = Math.max(0, (p - 0.9) / 0.1);
            if (centerProgress > 0) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, (radius / 4) * centerProgress, 0, Math.PI * 2);
                ctx.fillStyle = `rgb(139, 69, 19)`;
                ctx.fill();
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (puedeCrecer && progress < 1) {
                progress += 0.004;
            }

            let sway = 0;
            if (flowerComplete) {
                sway = Math.sin(Date.now() * 0.001) * (canvas.width * 0.01);
            }

            drawSky(progress);
            drawGrass(progress);
            
            if(puedeCrecer) {
                drawFlower(progress, sway);
            }
            
            if (progress >= 1 && !flowerComplete) {
                flowerComplete = true;
                finalMessageEl.textContent = "¡Feliz día! Te regalo esta flor amarilla";
                finalMessageEl.classList.remove('opacity-0');
                finalMessageEl.classList.add('animate-pulse');
                
                setTimeout(() => {
                    signatureEl.textContent = "Hecho por Andres el Ing";
                    signatureEl.classList.remove('opacity-0');
                }, 1500); // 1.5 segundos después
            }

            requestAnimationFrame(draw);
        }

        showNextMessage();
        createStars();
        draw();
    </script>
</body>
</html>
